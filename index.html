<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinVault - Your Financial Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --color-bg: #0f172a;
            --color-sidebar: #1e293b;
            --color-panel: #1e293b;
            --color-card-gradient-from: #334155;
            --color-card-gradient-to: #0f172a;
            --color-progress-bar: #334155;
            --color-progress-fill: #22c55e;
            --color-primary: #22c55e;
            --color-primary-hover: #16a34a;
            --color-secondary: #334155;
            --color-secondary-hover: #475569;
            --color-text: #e2e8f0;
            --color-border: #334155;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }
        .main-content {
            background-color: var(--color-panel);
        }
        .sidebar {
            background-color: var(--color-sidebar);
        }
        .card-gradient {
            background: linear-gradient(135deg, var(--color-card-gradient-from) 0%, var(--color-card-gradient-to) 100%);
        }
        .progress-bar-bg {
            background-color: var(--color-progress-bar);
        }
        .progress-bar-fill {
            background-color: var(--color-progress-fill);
        }
        .btn-primary {
            background-color: var(--color-primary);
            color: #ffffff;
        }
        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }
        .btn-secondary {
             background-color: var(--color-secondary);
             color: var(--color-text);
        }
        .btn-secondary:hover {
            background-color: var(--color-secondary-hover);
        }
        /* For custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Sidebar -->
    <aside class="sidebar w-16 md:w-64 flex-shrink-0 transition-all duration-300 ease-in-out hidden sm:flex flex-col">
        <div class="flex items-center justify-center md:justify-start px-4 h-20 border-b" style="border-color: var(--color-border);">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-8" style="color: var(--color-primary)"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
            <h1 class="text-2xl font-bold ml-2 hidden md:block">FinVault</h1>
        </div>
        <nav class="flex-1 px-2 py-4 space-y-2">
            <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg bg-slate-700" data-target="dashboard">
                <i data-lucide="layout-dashboard" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Dashboard</span>
            </a>
            <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="card-control">
                <i data-lucide="credit-card" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Card Control</span>
            </a>
            <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="budgets">
                <i data-lucide="pie-chart" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Budgets</span>
            </a>
            <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="vaults">
                <i data-lucide="shield-check" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Vaults</span>
            </a>
             <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="transactions">
                <i data-lucide="list" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Transactions</span>
            </a>
            <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="settings">
                <i data-lucide="settings" class="w-6 h-6"></i>
                <span class="ml-3 hidden md:block">Settings</span>
            </a>
        </nav>
        <div class="px-2 py-4 mt-auto border-t" style="border-color: var(--color-border);">
             <a href="#" class="flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700">
                <img src="https://i.pravatar.cc/150?u=a042581f4e29026704d" class="w-8 h-8 rounded-full" alt="User Avatar">
                <span class="ml-3 hidden md:block">John Doe</span>
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Header -->
        <header class="flex items-center justify-between h-20 px-6 border-b bg-slate-800" style="border-color: var(--color-border);">
             <div class="sm:hidden">
                 <button id="mobile-menu-button" class="p-2 rounded-md">
                     <i data-lucide="menu" class="w-6 h-6"></i>
                 </button>
             </div>
             <h1 class="text-xl font-semibold" id="page-title">Dashboard</h1>
             <div class="flex items-center space-x-4">
                 <button class="p-2 rounded-full hover:bg-slate-700">
                     <i data-lucide="bell" class="w-6 h-6"></i>
                 </button>
             </div>
        </header>

        <div class="flex-1 overflow-y-auto p-6 md:p-8 space-y-8" id="main-content-area">

            <!-- Dashboard Section -->
            <section id="dashboard" class="page-section space-y-8">
                <!-- Card and AI Section -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2">
                         <!-- Premium Smart Card -->
                        <div id="smart-card-display" class="card-gradient p-6 rounded-2xl shadow-lg relative h-56 transition-all duration-300">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-slate-400">Active Account</p>
                                    <h3 id="active-account-name" class="text-xl font-semibold">Current Account</h3>
                                </div>
                                <div class="flex items-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 text-white"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                                </div>
                            </div>
                            <div class="absolute bottom-6 left-6">
                                 <p class="text-sm text-slate-400">Total Balance</p>
                                <p id="card-balance" class="text-3xl font-bold">Rs 124,530.50</p>
                                <p id="card-number" class="text-lg font-mono tracking-widest mt-2 text-slate-300">**** **** **** 8021</p>
                            </div>
                            <div id="card-frozen-overlay" class="absolute inset-0 bg-black bg-opacity-60 rounded-2xl flex items-center justify-center hidden backdrop-blur-sm">
                                <i data-lucide="snowflake" class="w-16 h-16 text-blue-300"></i>
                                <p class="text-2xl font-bold text-blue-200 ml-4">Card Frozen</p>
                            </div>
                        </div>

                         <!-- Quick Actions -->
                        <div class="mt-6 grid grid-cols-2 sm:grid-cols-4 gap-4">
                             <button class="btn-secondary p-4 rounded-lg flex flex-col items-center justify-center space-y-2">
                                <i data-lucide="plus-circle" class="w-6 h-6"></i>
                                <span>Add Money</span>
                             </button>
                              <button class="nav-link btn-secondary p-4 rounded-lg flex flex-col items-center justify-center space-y-2" data-target="card-control">
                                <i data-lucide="shuffle" class="w-6 h-6"></i>
                                <span>Rotate Card</span>
                             </button>
                             <button id="freeze-card-btn-quick" class="btn-secondary p-4 rounded-lg flex flex-col items-center justify-center space-y-2">
                                <i data-lucide="snowflake" class="w-6 h-6"></i>
                                <span>Freeze Card</span>
                             </button>
                             <button class="btn-secondary p-4 rounded-lg flex flex-col items-center justify-center space-y-2">
                                <i data-lucide="send" class="w-6 h-6"></i>
                                <span>Send</span>
                             </button>
                        </div>
                    </div>

                    <!-- AI Financial Advisor -->
                    <div class="bg-slate-900/50 p-6 rounded-2xl flex flex-col">
                        <h3 class="text-lg font-semibold mb-4">AI Financial Advisor</h3>
                        <div class="flex items-start space-x-4">
                            <div class="p-2 rounded-full" style="background-color: var(--color-primary); opacity: 0.2;">
                                <i data-lucide="brain-circuit" class="w-6 h-6" style="color: var(--color-primary);"></i>
                            </div>
                            <div class="flex-1 bg-slate-700 p-4 rounded-lg">
                                <p class="text-sm">You've spent 15% less on food this month. Great job! Consider moving the Rs 3,500 savings to your 'Vacation' vault to reach your goal faster.</p>
                            </div>
                        </div>
                         <button class="btn-primary mt-auto py-2 px-4 rounded-lg w-full">Move Savings</button>
                    </div>
                </div>

                <!-- Budget Jars -->
                <div>
                    <h2 class="text-xl font-semibold mb-4">Budget Jars</h2>
                    <div id="dashboard-budgets" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                       <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Savings Vaults -->
                <div>
                    <h2 class="text-xl font-semibold mb-4">Savings Vaults</h2>
                    <div id="dashboard-vaults" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </section>

            <!-- Card Control Section -->
            <section id="card-control" class="page-section hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <div>
                        <h2 class="text-2xl font-semibold mb-4">Card Control</h2>
                        <div id="smart-card-display-control" class="card-gradient p-6 rounded-2xl shadow-lg relative h-56">
                             <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm text-slate-400">Active Account</p>
                                    <h3 id="active-account-name-control" class="text-xl font-semibold">Current Account</h3>
                                </div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 text-white"><rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect><line x1="1" y1="10" x2="23" y2="10"></line></svg>
                            </div>
                            <div class="absolute bottom-6 left-6">
                                <p id="card-number-control" class="text-lg font-mono tracking-widest text-slate-300">**** **** **** 8021</p>
                            </div>
                            <div id="card-frozen-overlay-control" class="absolute inset-0 bg-black bg-opacity-60 rounded-2xl flex items-center justify-center hidden backdrop-blur-sm">
                                <i data-lucide="snowflake" class="w-16 h-16 text-blue-300"></i>
                                <p class="text-2xl font-bold text-blue-200 ml-4">Card Frozen</p>
                            </div>
                        </div>
                         <div class="mt-6 flex items-center justify-between bg-slate-900/50 p-4 rounded-xl">
                            <div class="flex items-center">
                                <i data-lucide="snowflake" class="w-6 h-6 mr-3 text-blue-400"></i>
                                <span class="font-medium">Freeze Card</span>
                            </div>
                            <label for="freeze-toggle" class="inline-flex relative items-center cursor-pointer">
                                <input type="checkbox" value="" id="freeze-toggle" class="sr-only peer">
                                <div class="w-11 h-6 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-600"></div>
                            </label>
                        </div>
                        <button id="locate-card-btn" class="mt-4 w-full btn-secondary p-3 rounded-lg flex items-center justify-center">
                            <i data-lucide="map-pin" class="w-5 h-5 mr-2"></i>
                            Locate Card
                        </button>
                    </div>

                    <div class="bg-slate-900/50 p-6 rounded-2xl">
                        <h3 class="text-lg font-semibold mb-4">Rotate Active Account</h3>
                        <p class="text-sm text-slate-400 mb-6">Select which account or budget jar your physical card should use for the next transaction.</p>
                        <div class="space-y-3" id="account-selector">
                            <!-- Accounts will be populated by JS -->
                        </div>
                    </div>
                </div>
            </section>

             <!-- Budgets Section -->
            <section id="budgets" class="page-section hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold">My Budgets</h2>
                    <button id="new-budget-btn" class="btn-primary py-2 px-4 rounded-lg flex items-center">
                        <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                        New Budget
                    </button>
                 </div>
                 <div id="budgets-list" class="bg-slate-900/50 p-6 rounded-2xl space-y-6">
                    <!-- Populated by JS -->
                 </div>
            </section>
            
            <!-- Vaults Section -->
            <section id="vaults" class="page-section hidden">
                 <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-semibold">Savings Vaults</h2>
                    <button id="new-vault-btn" class="btn-primary py-2 px-4 rounded-lg flex items-center">
                        <i data-lucide="plus" class="w-5 h-5 mr-2"></i>
                        New Vault
                    </button>
                 </div>
                 <div id="vaults-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <!-- Populated by JS -->
                 </div>
            </section>
            
            <!-- Transactions Section -->
            <section id="transactions" class="page-section hidden">
                <h2 class="text-2xl font-semibold mb-6">All Transactions</h2>
                <div class="bg-slate-900/50 rounded-2xl overflow-hidden">
                    <table class="w-full text-left">
                        <thead class="bg-slate-800">
                            <tr>
                                <th class="p-4 font-semibold">Date</th>
                                <th class="p-4 font-semibold">Description</th>
                                <th class="p-4 font-semibold">Category</th>
                                <th class="p-4 font-semibold text-right">Amount</th>
                            </tr>
                        </thead>
                        <tbody id="transaction-list">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- Settings Section -->
            <section id="settings" class="page-section hidden space-y-8">
                <div>
                    <h2 class="text-2xl font-semibold mb-6">Settings</h2>
                    <div class="bg-slate-900/50 p-6 rounded-2xl">
                        <h3 class="text-lg font-semibold mb-4">Theme Customization</h3>
                        <p class="text-sm text-slate-400 mb-6">Choose a color scheme for your dashboard.</p>
                        <div id="theme-selector" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            <!-- Theme options will be generated by JS -->
                        </div>
                    </div>
                </div>

                <div>
                    <h2 class="text-2xl font-semibold mb-6">History</h2>
                     <div class="bg-slate-900/50 p-6 rounded-2xl mb-6">
                        <h3 class="text-lg font-semibold mb-4">Vault History</h3>
                        <table class="w-full text-left">
                           <thead class="border-b" style="border-color: var(--color-border);">
                               <tr>
                                   <th class="p-3 font-semibold">Date</th>
                                   <th class="p-3 font-semibold">Action</th>
                                   <th class="p-3 font-semibold">Details</th>
                               </tr>
                           </thead>
                           <tbody id="vault-history-list">
                               <!-- Populated by JS -->
                           </tbody>
                        </table>
                    </div>
                    <div class="bg-slate-900/50 p-6 rounded-2xl">
                        <h3 class="text-lg font-semibold mb-4">Budget History</h3>
                         <table class="w-full text-left">
                           <thead class="border-b" style="border-color: var(--color-border);">
                               <tr>
                                   <th class="p-3 font-semibold">Date</th>
                                   <th class="p-3 font-semibold">Action</th>
                                   <th class="p-3 font-semibold">Details</th>
                               </tr>
                           </thead>
                           <tbody id="budget-history-list">
                               <!-- Populated by JS -->
                           </tbody>
                        </table>
                    </div>
                </div>

            </section>
        </div>
    </main>

    <!-- Mobile Sidebar -->
    <div id="mobile-sidebar" class="fixed inset-0 bg-slate-900 z-40 transform -translate-x-full transition-transform duration-300 ease-in-out sm:hidden">
         <aside class="w-64 flex-shrink-0 flex flex-col h-full">
            <div class="flex items-center justify-between px-4 h-20 border-b border-slate-700">
                <div class="flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-8 w-8" style="color: var(--color-primary)"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                    <h1 class="text-2xl font-bold ml-2">FinVault</h1>
                </div>
                <button id="close-mobile-menu" class="p-2">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-2">
                <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg bg-slate-700" data-target="dashboard">
                    <i data-lucide="layout-dashboard" class="w-6 h-6"></i><span class="ml-3">Dashboard</span>
                </a>
                <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="card-control">
                    <i data-lucide="credit-card" class="w-6 h-6"></i><span class="ml-3">Card Control</span>
                </a>
                <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="budgets">
                    <i data-lucide="pie-chart" class="w-6 h-6"></i><span class="ml-3">Budgets</span>
                </a>
                <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="vaults">
                    <i data-lucide="shield-check" class="w-6 h-6"></i><span class="ml-3">Vaults</span>
                </a>
                <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="transactions">
                    <i data-lucide="list" class="w-6 h-6"></i><span class="ml-3">Transactions</span>
                </a>
                 <a href="#" class="nav-link flex items-center p-2 text-base font-normal rounded-lg hover:bg-slate-700" data-target="settings">
                    <i data-lucide="settings" class="w-6 h-6"></i><span class="ml-3">Settings</span>
                </a>
            </nav>
        </aside>
    </div>

    <!-- Modals -->
    <div id="map-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-slate-800 rounded-lg p-6 w-11/12 max-w-2xl text-center">
            <h3 class="text-xl font-semibold mb-4">Locating Your Card...</h3>
            <div class="aspect-video bg-slate-700 rounded-md flex items-center justify-center">
                <p></p>
                <i data-lucide="map" class="w-24 h-24 text-slate-500"></i>
            </div>
            <p class="mt-4 text-slate-400">Last seen: 2 minutes ago at Tariq Road, Karachi</p>
            <button id="close-map-modal" class="mt-6 btn-primary py-2 px-6 rounded-lg">Close</button>
        </div>
    </div>
    
    <div id="new-vault-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-slate-800 rounded-lg p-6 w-11/12 max-w-md">
            <h3 class="text-xl font-semibold mb-4">Create New Vault</h3>
            <form id="new-vault-form" class="space-y-4">
                <div>
                    <label for="vault-name" class="block text-sm font-medium text-slate-300 mb-1">Vault Name</label>
                    <input type="text" id="vault-name" name="vault-name" class="w-full bg-slate-700 border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-green-500" placeholder="e.g., Vacation Trip" required>
                </div>
                <div>
                    <label for="vault-target" class="block text-sm font-medium text-slate-300 mb-1">Target Amount</label>
                    <input type="number" id="vault-target" name="vault-target" class="w-full bg-slate-700 border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-green-500" placeholder="e.g., 200000" required>
                </div>
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="cancel-vault-creation" class="btn-secondary py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" class="btn-primary py-2 px-4 rounded-lg">Create Vault</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="new-budget-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-slate-800 rounded-lg p-6 w-11/12 max-w-md">
            <h3 class="text-xl font-semibold mb-4">Create New Budget</h3>
            <form id="new-budget-form" class="space-y-4">
                <div>
                    <label for="budget-name" class="block text-sm font-medium text-slate-300 mb-1">Budget Name</label>
                    <input type="text" id="budget-name" name="budget-name" class="w-full bg-slate-700 border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-green-500" placeholder="e.g., Groceries" required>
                </div>
                <div>
                    <label for="budget-limit" class="block text-sm font-medium text-slate-300 mb-1">Monthly Limit</label>
                    <input type="number" id="budget-limit" name="budget-limit" class="w-full bg-slate-700 border-slate-600 rounded-md p-2 focus:ring-2 focus:ring-green-500" placeholder="e.g., 25000" required>
                </div>
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" id="cancel-budget-creation" class="btn-secondary py-2 px-4 rounded-lg">Cancel</button>
                    <button type="submit" class="btn-primary py-2 px-4 rounded-lg">Create Budget</button>
                </div>
            </form>
        </div>
    </div>


<script>
    lucide.createIcons();

    // --- MOCK DATA ---
    const accounts = [
        { id: 'current', name: 'Current Account', balance: 124530.50, type: 'account' },
        { id: 'food', name: 'Food Jar', balance: 7660, type: 'budget' },
        { id: 'shopping', name: 'Shopping Jar', balance: 7190, type: 'budget' },
        { id: 'transport', name: 'Transport Jar', balance: 500, type: 'budget' },
    ];
    
    let budgetsData = [
        { id: 'food', name: 'Food', spent: 12340, limit: 20000, icon: 'utensils-crossed', color: 'rose' },
        { id: 'shopping', name: 'Shopping', spent: 7810, limit: 15000, icon: 'shopping-cart', color: 'sky' },
        { id: 'transport', name: 'Transport', spent: 9500, limit: 10000, icon: 'car', color: 'amber' },
    ];

    let vaultsData = [
        { id: 'emergency', name: 'Emergency Fund', current: 85000, target: 100000, icon: 'shield', color: 'indigo' },
        { id: 'laptop', name: 'New Laptop', current: 60000, target: 150000, icon: 'briefcase', color: 'cyan' },
        { id: 'vacation', name: 'Vacation Trip', current: 130000, target: 200000, icon: 'plane', color: 'fuchsia' },
    ];
    
    const vaultHistoryData = [
        { date: 'Aug 20, 2025', action: 'Created', details: 'Emergency Fund (Target: Rs 100,000)'},
        { date: 'Aug 25, 2025', action: 'Created', details: 'New Laptop (Target: Rs 150,000)'},
        { date: 'Sep 1, 2025', action: 'Closed', details: 'Old Phone Vault (Achieved)'},
    ];
    
    const budgetHistoryData = [
        { date: 'Aug 1, 2025', action: 'Created', details: 'Food Budget (Limit: Rs 20,000)'},
        { date: 'Aug 15, 2025', action: 'Updated', details: 'Transport Budget (Limit: Rs 10,000 -> Rs 12,000)'},
        { date: 'Sep 1, 2025', action: 'Archived', details: 'August Shopping Budget'},
    ];
    
    const transactionsData = [
        { date: 'Sep 1, 2025', desc: 'Netflix Subscription', cat: 'Entertainment', amount: -1200.00 },
        { date: 'Sep 1, 2025', desc: 'Foodpanda Order', cat: 'Food', amount: -2550.00 },
        { date: 'Aug 31, 2025', desc: 'Daraz Online Shopping', cat: 'Shopping', amount: -5400.00 },
        { date: 'Aug 30, 2025', desc: 'Salary Deposit', cat: 'Income', amount: 95000.00 },
        { date: 'Aug 29, 2025', desc: 'Careem Ride', cat: 'Transport', amount: -850.00 },
    ];

    let activeAccountId = 'current';
    let isCardFrozen = false;

    // --- DOM ELEMENTS ---
    const pageSections = document.querySelectorAll('.page-section');
    const navLinks = document.querySelectorAll('.nav-link');
    const pageTitle = document.getElementById('page-title');
    const mobileSidebar = document.getElementById('mobile-sidebar');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const closeMobileMenuButton = document.getElementById('close-mobile-menu');

    // Card display elements
    const cardDisplay = document.getElementById('smart-card-display');
    const activeAccountName = document.getElementById('active-account-name');
    const cardBalance = document.getElementById('card-balance');
    const cardFrozenOverlay = document.getElementById('card-frozen-overlay');

    // Card control elements
    const cardDisplayControl = document.getElementById('smart-card-display-control');
    const activeAccountNameControl = document.getElementById('active-account-name-control');
    const cardFrozenOverlayControl = document.getElementById('card-frozen-overlay-control');
    const freezeToggle = document.getElementById('freeze-toggle');
    const accountSelector = document.getElementById('account-selector');
    const freezeBtnQuick = document.getElementById('freeze-card-btn-quick');

    // Modal elements
    const mapModal = document.getElementById('map-modal');
    const locateCardBtn = document.getElementById('locate-card-btn');
    const closeMapModalBtn = document.getElementById('close-map-modal');
    
    const newVaultModal = document.getElementById('new-vault-modal');
    const newBudgetModal = document.getElementById('new-budget-modal');
    const newVaultBtn = document.getElementById('new-vault-btn');
    const newBudgetBtn = document.getElementById('new-budget-btn');
    const newVaultForm = document.getElementById('new-vault-form');
    const newBudgetForm = document.getElementById('new-budget-form');
    
    // Transactions
    const transactionList = document.getElementById('transaction-list');
    
    // Theme elements
    const themeSelector = document.getElementById('theme-selector');

    // --- THEME CUSTOMIZATION ---
    const themes = {
        'Slate': {
            '--color-bg': '#0f172a', '--color-sidebar': '#1e293b', '--color-panel': '#1e293b',
            '--color-card-gradient-from': '#334155', '--color-card-gradient-to': '#0f172a',
            '--color-primary': '#22c55e', '--color-primary-hover': '#16a34a',
            '--color-progress-fill': '#22c55e',
        },
        'Ocean': {
            '--color-bg': '#0B2545', '--color-sidebar': '#13315C', '--color-panel': '#13315C',
            '--color-card-gradient-from': '#1E4976', '--color-card-gradient-to': '#0B2545',
            '--color-primary': '#37BEEB', '--color-primary-hover': '#24A8D6',
            '--color-progress-fill': '#37BEEB',
        },
        'Forest': {
            '--color-bg': '#1a2e29', '--color-sidebar': '#243b35', '--color-panel': '#243b35',
            '--color-card-gradient-from': '#2f5d51', '--color-card-gradient-to': '#1a2e29',
            '--color-primary': '#34d399', '--color-primary-hover': '#10b981',
            '--color-progress-fill': '#34d399',
        },
        'Sunset': {
            '--color-bg': '#4c1d3d', '--color-sidebar': '#6b2a57', '--color-panel': '#6b2a57',
            '--color-card-gradient-from': '#9d3d7a', '--color-card-gradient-to': '#4c1d3d',
            '--color-primary': '#f472b6', '--color-primary-hover': '#ec4899',
            '--color-progress-fill': '#f472b6',
        }
    };

    function applyTheme(themeName) {
        const theme = themes[themeName];
        for (const [key, value] of Object.entries(theme)) {
            document.documentElement.style.setProperty(key, value);
        }
    }

    function saveTheme(themeName) {
        localStorage.setItem('finvaultTheme', themeName);
    }

    function loadTheme() {
        const savedTheme = localStorage.getItem('finvaultTheme') || 'Slate';
        applyTheme(savedTheme);
        return savedTheme;
    }

    function generateThemeSelector() {
        const currentTheme = loadTheme();
        themeSelector.innerHTML = '';
        for (const themeName in themes) {
            const theme = themes[themeName];
            const isActive = themeName === currentTheme;
            const button = document.createElement('button');
            button.className = `theme-btn p-4 rounded-lg border-2 ${isActive ? 'border-white' : 'border-transparent'} transition-all`;
            button.dataset.theme = themeName;
            button.innerHTML = `
                <div class="h-12 w-full rounded-md mb-2" style="background: linear-gradient(135deg, ${theme['--color-card-gradient-from']}, ${theme['--color-card-gradient-to']})"></div>
                <p class="font-medium">${themeName}</p>
            `;
            themeSelector.appendChild(button);
        }
    }

    themeSelector.addEventListener('click', (e) => {
        const themeBtn = e.target.closest('.theme-btn');
        if (themeBtn) {
            const themeName = themeBtn.dataset.theme;
            applyTheme(themeName);
            saveTheme(themeName);
            // Update active state on buttons
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('border-white', btn.dataset.theme === themeName);
                 btn.classList.toggle('border-transparent', btn.dataset.theme !== themeName);
            });
        }
    });

    // --- FUNCTIONS ---

    function showPage(targetId) {
        pageSections.forEach(section => {
            section.classList.toggle('hidden', section.id !== targetId);
        });
        const targetLink = document.querySelector(`.nav-link[data-target="${targetId}"]`);
        if (targetLink) {
            pageTitle.textContent = targetLink.querySelector('span').textContent;
        }
        navLinks.forEach(link => {
            link.classList.remove('bg-slate-700');
            if (link.dataset.target === targetId) {
                link.classList.add('bg-slate-700');
            }
        });
        mobileSidebar.classList.add('-translate-x-full');
    }

    function updateUI() {
        const activeAccount = accounts.find(acc => acc.id === activeAccountId);
        activeAccountName.textContent = activeAccount.name;
        activeAccountNameControl.textContent = activeAccount.name;
        cardBalance.textContent = `Rs ${accounts.find(a => a.id === 'current').balance.toLocaleString('en-IN', { minimumFractionDigits: 2 })}`;

        cardFrozenOverlay.classList.toggle('hidden', !isCardFrozen);
        cardFrozenOverlayControl.classList.toggle('hidden', !isCardFrozen);
        freezeToggle.checked = isCardFrozen;
        [cardDisplay, cardDisplayControl].forEach(el => el.classList.toggle('grayscale', isCardFrozen));

        populateAccountSelector();
        renderDashboardItems();
    }

    function populateAccountSelector() {
        accountSelector.innerHTML = '';
        accounts.forEach(account => {
            const isChecked = account.id === activeAccountId;
            accountSelector.insertAdjacentHTML('beforeend', `
                <label for="acc-${account.id}" class="flex items-center p-4 rounded-lg cursor-pointer transition-colors ${isChecked ? 'bg-green-500/20 border-green-500' : 'bg-slate-800 border-transparent'} border hover:bg-slate-700">
                    <input type="radio" id="acc-${account.id}" name="activeAccount" value="${account.id}" class="hidden" ${isChecked ? 'checked' : ''}>
                    <div class="flex-1">
                        <p class="font-medium">${account.name}</p>
                        <p class="text-sm text-slate-400">Available: Rs ${account.balance.toLocaleString('en-IN')}</p>
                    </div>
                    ${isChecked ? '<i data-lucide="check-circle-2" class="w-6 h-6 text-green-500"></i>' : ''}
                </label>
            `);
        });
        lucide.createIcons();
    }
    
    function populateTransactions() {
        transactionList.innerHTML = '';
        transactionsData.forEach(tx => {
            const amountClass = tx.amount > 0 ? 'text-green-400' : 'text-slate-300';
            const sign = tx.amount > 0 ? '+' : '';
            transactionList.insertAdjacentHTML('beforeend', `
                <tr class="border-b last:border-b-0" style="border-color: var(--color-border);">
                    <td class="p-4">${tx.date}</td>
                    <td class="p-4 font-medium">${tx.desc}</td>
                    <td class="p-4 text-slate-400">${tx.cat}</td>
                    <td class="p-4 text-right font-mono ${amountClass}">${sign}Rs ${Math.abs(tx.amount).toLocaleString('en-IN', { minimumFractionDigits: 2 })}</td>
                </tr>
            `);
        });
    }
    
    function renderDashboardItems() {
        const dashboardBudgets = document.getElementById('dashboard-budgets');
        dashboardBudgets.innerHTML = '';
        budgetsData.slice(0, 3).forEach(budget => {
            const percentage = Math.round((budget.spent / budget.limit) * 100);
            const progressBarColor = percentage > 90 ? 'bg-red-500' : 'progress-bar-fill';
            dashboardBudgets.insertAdjacentHTML('beforeend', `
                 <div class="bg-slate-900/50 p-4 rounded-xl">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                            <div class="p-2 bg-${budget.color}-500/20 rounded-lg"><i data-lucide="${budget.icon}" class="w-5 h-5 text-${budget.color}-400"></i></div>
                            <span class="font-medium">${budget.name}</span>
                        </div>
                        <span class="text-sm font-mono">Rs ${budget.spent.toLocaleString()} / ${budget.limit.toLocaleString()}</span>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-2.5">
                        <div class="${progressBarColor} h-2.5 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `);
        });

        const dashboardVaults = document.getElementById('dashboard-vaults');
        dashboardVaults.innerHTML = '';
        vaultsData.slice(0, 3).forEach(vault => {
            const percentage = Math.round((vault.current / vault.target) * 100);
            dashboardVaults.insertAdjacentHTML('beforeend', `
                 <div class="bg-slate-900/50 p-4 rounded-xl">
                    <div class="flex items-center justify-between mb-2">
                        <div class="flex items-center space-x-3">
                             <div class="p-2 bg-${vault.color}-500/20 rounded-lg"><i data-lucide="${vault.icon}" class="w-5 h-5 text-${vault.color}-400"></i></div>
                            <span class="font-medium">${vault.name}</span>
                        </div>
                        <span class="text-sm font-semibold" style="color: var(--color-primary)">${percentage}%</span>
                    </div>
                     <p class="text-lg font-mono mb-2">Rs ${vault.current.toLocaleString()} / ${vault.target.toLocaleString()}</p>
                    <div class="w-full progress-bar-bg rounded-full h-2.5">
                        <div class="progress-bar-fill h-2.5 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `);
        });
        lucide.createIcons();
    }

    function renderBudgets() {
        const container = document.getElementById('budgets-list');
        container.innerHTML = '';
        budgetsData.forEach((budget, index) => {
            const percentage = Math.round((budget.spent / budget.limit) * 100);
            const progressBarColor = percentage > 90 ? 'bg-red-500' : 'progress-bar-fill';
            const borderClass = index > 0 ? 'border-t pt-6 mt-6' : '';
            container.insertAdjacentHTML('beforeend', `
                <div class="budget-item-full ${borderClass}" style="border-color: var(--color-border);">
                    <div class="flex items-center justify-between mb-2">
                         <div class="flex items-center space-x-4">
                            <div class="p-3 bg-${budget.color}-500/20 rounded-lg"><i data-lucide="${budget.icon}" class="w-6 h-6 text-${budget.color}-400"></i></div>
                            <div>
                                <h4 class="font-semibold text-lg">${budget.name}</h4>
                                <p class="text-sm text-slate-400">Spent <span class="font-mono">Rs ${budget.spent.toLocaleString()}</span> of <span class="font-mono">Rs ${budget.limit.toLocaleString()}</span></p>
                            </div>
                        </div>
                        <span class="font-medium text-lg ${percentage > 90 ? 'text-red-400' : ''}">${percentage}% Used</span>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-3">
                        <div class="${progressBarColor} h-3 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                </div>
            `);
        });
        lucide.createIcons();
    }

    function renderVaults() {
        const container = document.getElementById('vaults-list');
        container.innerHTML = '';
        vaultsData.forEach(vault => {
            const percentage = Math.round((vault.current / vault.target) * 100);
            container.insertAdjacentHTML('beforeend', `
                <div class="bg-slate-900/50 p-6 rounded-2xl">
                    <div class="flex items-center space-x-4 mb-4">
                        <div class="p-3 bg-${vault.color}-500/20 rounded-lg"><i data-lucide="${vault.icon}" class="w-8 h-8 text-${vault.color}-400"></i></div>
                         <div>
                            <h4 class="font-semibold text-lg">${vault.name}</h4>
                            <p class="text-sm text-slate-400">Target: Rs ${vault.target.toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="text-center my-4">
                        <p class="text-3xl font-bold font-mono">Rs ${vault.current.toLocaleString()}</p>
                        <p class="font-medium mt-1" style="color: var(--color-primary)">${percentage}% Complete</p>
                    </div>
                    <div class="w-full progress-bar-bg rounded-full h-3 mb-4">
                        <div class="progress-bar-fill h-3 rounded-full" style="width: ${percentage}%"></div>
                    </div>
                     <div class="flex gap-4">
                         <button class="flex-1 btn-secondary py-2 rounded-lg">Withdraw</button>
                         <button class="flex-1 btn-primary py-2 rounded-lg">Deposit</button>
                     </div>
                </div>
            `);
        });
        lucide.createIcons();
    }
    
    function renderHistory() {
        const vaultHistoryList = document.getElementById('vault-history-list');
        vaultHistoryList.innerHTML = '';
        vaultHistoryData.forEach(item => {
            vaultHistoryList.insertAdjacentHTML('beforeend', `
                <tr class="border-b last:border-b-0" style="border-color: var(--color-border);">
                    <td class="p-3 text-slate-400">${item.date}</td>
                    <td class="p-3 font-medium">${item.action}</td>
                    <td class="p-3">${item.details}</td>
                </tr>
            `);
        });
        
        const budgetHistoryList = document.getElementById('budget-history-list');
        budgetHistoryList.innerHTML = '';
        budgetHistoryData.forEach(item => {
            budgetHistoryList.insertAdjacentHTML('beforeend', `
                 <tr class="border-b last:border-b-0" style="border-color: var(--color-border);">
                    <td class="p-3 text-slate-400">${item.date}</td>
                    <td class="p-3 font-medium">${item.action}</td>
                    <td class="p-3">${item.details}</td>
                </tr>
            `);
        });
    }

    // --- EVENT LISTENERS ---
    navLinks.forEach(link => link.addEventListener('click', (e) => showPage(e.currentTarget.dataset.target)));
    accountSelector.addEventListener('change', (e) => {
        if(e.target.name === 'activeAccount') {
            activeAccountId = e.target.value;
            updateUI();
        }
    });
    
    function toggleFreeze() { isCardFrozen = !isCardFrozen; updateUI(); }
    freezeToggle.addEventListener('change', toggleFreeze);
    freezeBtnQuick.addEventListener('click', toggleFreeze);
    
    locateCardBtn.addEventListener('click', () => mapModal.classList.remove('hidden'));
    closeMapModalBtn.addEventListener('click', () => mapModal.classList.add('hidden'));
    
    mobileMenuButton.addEventListener('click', () => mobileSidebar.classList.remove('-translate-x-full'));
    closeMobileMenuButton.addEventListener('click', () => mobileSidebar.classList.add('-translate-x-full'));
    
    // New Creation Modals
    newVaultBtn.addEventListener('click', () => newVaultModal.classList.remove('hidden'));
    document.getElementById('cancel-vault-creation').addEventListener('click', () => newVaultModal.classList.add('hidden'));
    newVaultModal.addEventListener('click', (e) => { if (e.target === newVaultModal) newVaultModal.classList.add('hidden'); });
    
    newBudgetBtn.addEventListener('click', () => newBudgetModal.classList.remove('hidden'));
    document.getElementById('cancel-budget-creation').addEventListener('click', () => newBudgetModal.classList.add('hidden'));
    newBudgetModal.addEventListener('click', (e) => { if (e.target === newBudgetModal) newBudgetModal.classList.add('hidden'); });
    
    newVaultForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = e.target.elements['vault-name'].value;
        const target = parseFloat(e.target.elements['vault-target'].value);
        if (name && target > 0) {
            vaultsData.push({
                id: name.toLowerCase().replace(' ', '-'),
                name: name,
                current: 0,
                target: target,
                icon: 'package-plus',
                color: 'teal'
            });
            renderVaults();
            newVaultModal.classList.add('hidden');
            e.target.reset();
        }
    });

    newBudgetForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = e.target.elements['budget-name'].value;
        const limit = parseFloat(e.target.elements['budget-limit'].value);
        if (name && limit > 0) {
            budgetsData.push({
                id: name.toLowerCase().replace(' ', '-'),
                name: name,
                spent: 0,
                limit: limit,
                icon: 'receipt',
                color: 'purple'
            });
            renderBudgets();
            newBudgetModal.classList.add('hidden');
            e.target.reset();
        }
    });
    
    // --- INITIALIZATION ---
    document.addEventListener('DOMContentLoaded', () => {
        generateThemeSelector();
        updateUI();
        populateTransactions();
        renderBudgets();
        renderVaults();
        renderHistory();
        showPage('dashboard');
    });
</script>
</body>
</html>

